# Player Event Tests Integration Test Makefile

include .env

.PHONY: help test-player-events test-player-join test-player-leave test-multiple-player-events clean-test setup-test debug-aws test-report

help: ## Player Event Testsçµ±åˆãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
	@echo "Player Event Tests Integration Commands"
	@echo ""
	@echo "åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰:"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  \033[36m%-30s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)

## =============================================================================
## Player Event Tests çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
## =============================================================================

test-player-events: ## å…¨Player Event Testsçµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
	@echo "ğŸš€ Player Event Testsçµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹..."
	@echo ""
	@echo "ãƒ†ã‚¹ãƒˆå¯¾è±¡:"
	@echo "  - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ ã‚¤ãƒ™ãƒ³ãƒˆ (player_join)"
	@echo "  - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é›¢è„±ã‚¤ãƒ™ãƒ³ãƒˆ (player_leave)"
	@echo "  - è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†"
	@echo ""
	@echo "ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼: API Gateway â†’ SQS â†’ Discord Bot"
	@echo ""
	./gradlew clean integrationTest --info
	@echo ""
	@echo "âœ… Player Event Testsçµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†"

test-player-join: ## ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ
	@echo "ğŸ® ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
	@echo "ãƒ†ã‚¹ãƒˆå†…å®¹: player_join ã‚¤ãƒ™ãƒ³ãƒˆ â†’ Discord Botå‡¦ç†"
	./gradlew clean test --tests "*shouldSendPlayerJoinEventAndReceiveInSqs*" --info

test-player-leave: ## ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é›¢è„±ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ
	@echo "ğŸšª ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é›¢è„±ã‚¤ãƒ™ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
	@echo "ãƒ†ã‚¹ãƒˆå†…å®¹: player_leave ã‚¤ãƒ™ãƒ³ãƒˆ â†’ Discord Botå‡¦ç†"
	./gradlew clean test --tests "*shouldSendPlayerLeaveEventAndReceiveInSqs*" --info

test-multiple-player-events: ## è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãƒ†ã‚¹ãƒˆ
	@echo "ğŸ”„ è¤‡æ•°ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ..."
	@echo "ãƒ†ã‚¹ãƒˆå†…å®¹: join/leave ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¦è¡Œå‡¦ç†"
	./gradlew clean test --tests "*shouldHandleMultiplePlayerEventsViaApiGateway*" --info

## =============================================================================
## ãƒ†ã‚¹ãƒˆçµæœã¨ãƒ¬ãƒãƒ¼ãƒˆ
## =============================================================================

test-report: ## ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
	@echo "ğŸ“Š Player Event Testsçµ±åˆãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ:"
	@echo ""
	@if [ -f build/reports/tests/integrationTest/index.html ]; then \
		echo "ğŸ“„ HTML ãƒ¬ãƒãƒ¼ãƒˆ: build/reports/tests/integrationTest/index.html"; \
		echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸: build/reports/jacoco/test/html/index.html"; \
		echo ""; \
		echo "ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª: open build/reports/tests/integrationTest/index.html"; \
	else \
		echo "âŒ ãƒ†ã‚¹ãƒˆçµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã« 'make test-player-events' ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"; \
	fi

clean-test: ## ãƒ†ã‚¹ãƒˆçµæœã¨ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ã‚¯ãƒªã‚¢
	@echo "ğŸ§¹ ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ä¸­..."
	./gradlew clean
	@echo "âœ… ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"

## =============================================================================
## ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
## =============================================================================

debug-aws: ## AWSæ¥ç¶šç¢ºèª
	@echo "ğŸ” AWSæ¥ç¶šç¢ºèªä¸­..."
	@echo "Profile: $(AWS_PROFILE)"
	aws sts get-caller-identity --profile $(AWS_PROFILE) || echo "âŒ AWSèªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ"
	@echo ""
	@echo "API Gateway æ¥ç¶šç¢ºèª:"
	aws apigateway get-rest-apis --profile $(AWS_PROFILE) --query 'items[?name==`kishax-infrastructure-api`].{id:id,name:name}' --output table || echo "âŒ API Gatewayæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ"
	@echo ""
	@echo "SQS ã‚­ãƒ¥ãƒ¼ç¢ºèª:"
	aws sqs list-queues --profile $(AWS_PROFILE) --queue-name-prefix kishax || echo "âŒ SQSæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ"

setup-test: ## ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
	@echo "ğŸ”§ Player Event Testsç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯..."
	@echo ""
	@echo "å¿…è¦ãªç’°å¢ƒå¤‰æ•°:"
	@echo "  - AWS_PROFILE: $(AWS_PROFILE)"
	@echo "  - AWS_REGION: $(AWS_REGION)"
	@echo "  - AWS_ACCOUNT_ID: $(AWS_ACCOUNT_ID)"
	@echo ""
	@echo "Javaç‰ˆæœ¬ç¢ºèª:"
	java -version
	@echo ""
	@echo "Gradleç‰ˆæœ¬ç¢ºèª:"
	./gradlew --version | head -5
	@echo ""
	@echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯å®Œäº†"
