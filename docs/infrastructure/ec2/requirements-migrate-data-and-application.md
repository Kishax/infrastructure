# データ移植とアプリケーション改修にあたっての要件
順序
1.
S3に画像マップのオリジナルを移動させる。
こちら実装に修正あり。
理由はS3で管理するフラグも用意していないし、awsのパッケージだってJava環境にないと思う。あるかもしれない。
S3のディレクトリ構造はこんな感じになると思う。
yyyymmdd/[uuid].png …..
これがたくさんあるイメージ。これはプラグイン実装に基づいてる。
問題はS3から画像データを保存するときの処理と取り出すときの処理(取り出すときの処理があったかどうかは覚えてないが、確かあったような)でS3フラグがtrueの時に適切にS3と通信する必要がある点。

2.
Mysql へのSQLデータ移植
画像データが重いので、時間がかかりそう。
statusテーブルが一番の肝。
現在は、mysqlとの接続が開始できた段階でバッシュでstatusテーブルにサーバメターデータを入れてる？
ここをおそらく、何も書く必要がなくなる。なぜなら、Velocityプラグイン側でそれらを調整しているため。ymlだけは要調整。
おそらく、.bak/db/mc/status_202512141846.sql にあるサーバを全て、現在のservers.json でサーバのテンプレートを作るには少し時間がかかるので、サーバテンプレートは作らないが、ymlを生成し、仮に.bak/db/mc/status_202512141846.sql をRDS MySQLに移植してもVelocityアプリケーションがエラーを吐かないようにする必要がある。またそれらは起動できないように、statusテーブルの確か起動できなくさせるフラグがあったと思うので、それを活用する。
これに合わせて、home, latest, proxy という名前で3つのサーバをDocker内で標準で立てるようにする。latestは最初から起動せず、home, proxyだけが常時起動しているイメージ。KishaxのSpigot, Velocityプラグインの性質上、アプリケーション側から、つまり、homeサーバからlatestサーバを起動することはできるので、これがよい。メモリ配分はhome, latest, proxy以外は0メモリ。homeが0.2, latestが0.5, proxyが0.1-0.2。
ただ、ワールドデータの取り扱いに注意しなければならない。
今の所、S3にワールドデータを保存し、1度起動した後でaws s3 copyでi-aインスタンスに移動させ、docker cp でコンテナ内に移動させる予定ではある。この辺が整理されていないところ。
ここは、もし、事前にS3にworldデータがあり、そのサーバディレクトリ直下に`__IMPORT__ENABLED__` という空ファイルがあるならば、それをdocker起動時にインポートするようにし、一度インポートすれば、永続化データにフラグファイルが保存され、2回目以降のそれはないようになる、などはどうだろうか。
（または、apps/mc 側のS3パスとversionセットがあればそれを適用するなど。）
この場合のS3のディレクトリ構成としては
202506/1/latest/world
202506/1/latest/world_nether
202506/1/latest/world_the_end
だから、おそらく、今のservers.json にimportモードというのを追加すればいいのではないだろうか？s3import(true/false)。
これにより、最新のyyyymmddディレクトリで、かつそのサーバー名ディレクトリであり、`__IMPORT_ENABLED__` というファイルがあるならば(2段階認証)、また、ボリュームの永続化データファイルに記述が何もないのであれば、これをコンテナ起動前に全てコピーし、テンプレートファイルを持って、起動するようにする。
これはどうか？

3.
.bak/db/web/users_202512141848.sql には今年の6月までのメールアドレスやニックネームを含む、顧客情報が含まれている。これを今のpostgres, kishax_main に移植するにあたり、現在のusersテーブルと構成が異なるために、この.bak/db/web/users_202512141848.sql  のファイルより、新たにシードファイルを生成してほしい。これを私が手動でRDS MySQLデータベースに移植するコマンドを実行する。