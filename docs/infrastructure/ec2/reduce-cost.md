重要な質問です！スポットインスタンスのリスクについて正確に説明します。

## :warning: スポットインスタンスの動作

### 中断時の挙動

**デフォルト動作**: インスタンスが**終了（terminate）**される
- :white_check_mark: **IPアドレス**: 動的IPが変わる
- :x: **データ**: **EC2のルートボリューム（EBS）が削除される** → **ワールドデータが消える！**

これは**致命的**です。マイクラサーバーのワールドデータが消えたら復旧不可能です。

---

## :shield: 対策方法

### Option 1: EBS永続化設定（複雑）
```terraform
# 別途EBSボリューム作成
resource "aws_ebs_volume" "mc_data" {
  size = 100
  type = "gp3"
  
  tags = {
    Name = "mc-world-data"
  }
}

# インスタンス設定
instance_interruption_behavior = "stop"  # terminate の代わりに stop
delete_on_termination = false  # EBS削除を防ぐ
```

**問題点**:
- 中断時に`stop`しても、スポット価格が高いままなら再起動できない
- 手動で再アタッチが必要になる可能性
- 運用が複雑

### Option 2: 定期的にS3バックアップ（リスク残る）
- cronで1時間ごとにワールドデータをS3にバックアップ
- 中断時は最大1時間分のデータロス
- 復旧に時間がかかる

---

## :bulb: 私の推奨案（修正版）

### **i-a（マイクラサーバー）はオンデマンドにする**

**理由**:
1. **データの永続性が最重要** → スポットのリスクは受け入れられない
2. 5h/day稼働なので、コスト増は$10程度
3. プレイヤー体験に直結（中断は許容できない）

### **i-b, i-cはスポット可能**

**理由**:
- ほぼステートレス（データはRDSに保存）
- 中断しても自動再起動で復旧可能
- API/Webは数分のダウンタイムは許容範囲

---

## :bar_chart: 修正後のコスト試算

| リソース | 変更内容 | 月額（USD） |
|---------|---------|------------|
| i-a (MC Server) | **t3.large オンデマンド**, 5h/day | **$15** :arrow_up: |
| i-b (API) | t3.small スポット, 24h | **$4.5** |
| i-c (Web) | t2.micro スポット, 24h | **$2.4** |
| i-d (Jump) | t2.micro, 2h/month | $0.5 |
| RDS PostgreSQL | db.t4g.micro, 20GB, 3日 | **$10** |
| RDS MySQL | db.t4g.micro, 20GB, 3日 | **$10** |
| SQS | 標準キュー | $1 |
| CloudFront | 最適化 | **$2** |
| Elastic IP | i-a用（稼働時のみ） | **$0.2** |
| **合計** | | **$45.6 (約¥6,900)** :white_check_mark: |

---

## :dart: さらなるコスト削減案

### 1. **RDSをSavings Plansで契約**
- 1年契約で40%削減
- $20 → **$12**（両方で）
- 総額: **$37.6/月（約¥5,700）** :white_check_mark: 目標達成！

### 2. **i-aのインスタンスサイズを見直し**
- `t3.large` (8GB) → `t3.medium` (4GB) も検討
- Minecraftサーバーのメモリ要件次第
- $15 → **$7.5**
- 総額: **$38.1/月（約¥5,800）** :white_check_mark:

---

## :white_check_mark: 最終推奨プラン

```
- i-a: オンデマンド（データ保護優先）
- i-b, i-c: スポット（コスト削減）
- RDS: Savings Plans（1年契約）
```

**月額: $37.6（約¥5,700）** → 目標達成！

**質問**:
1. i-aはオンデマンドで進める？（データ保護優先）
2. i-aのサイズは t3.large で十分？それとも t3.medium で試す？

この方針でよろしければ実装開始します！