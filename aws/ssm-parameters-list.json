{
  "description": "Kishax Web-MC双方向通信システム用SSMパラメータ設定リスト",
  "version": "1.0",
  "parameters": {
    "required": {
      "/kishax/sqs/web-to-mc-queue-url": {
        "description": "Web→MC通信用SQSキューURL",
        "type": "String",
        "source": "CloudFormation Output: WebToMcQueueUrl",
        "example": "https://sqs.ap-northeast-1.amazonaws.com/123456789012/kishax-web-to-mc-queue-v2",
        "used_by": ["kishax-web ECS task"]
      },
      "/kishax/sqs/mc-to-web-queue-url": {
        "description": "MC→Web通信用SQSキューURL", 
        "type": "String",
        "source": "CloudFormation Output: McToWebQueueUrl",
        "example": "https://sqs.ap-northeast-1.amazonaws.com/123456789012/kishax-mc-to-web-queue-v2",
        "used_by": ["kishax-web ECS task", "mc-plugins"]
      },
      "/kishax/api/gateway-url": {
        "description": "API Gateway ベースURL",
        "type": "String", 
        "source": "CloudFormation Output: ApiGatewayUrl",
        "example": "https://abcd1234.execute-api.ap-northeast-1.amazonaws.com/prod",
        "used_by": ["kishax-web ECS task", "mc-plugins"]
      }
    },
    "existing": {
      "/kishax/sqs/queue-url": {
        "description": "Discord Bot用SQSキューURL（既存）",
        "type": "String",
        "source": "Existing SSM parameter",
        "used_by": ["discord-bot ECS task"]
      },
      "/kishax/web/mc-socket-host": {
        "description": "MC Socket通信ホスト（フォールバック用）",
        "type": "String",
        "source": "Manual configuration",
        "example": "mc.kishax.net",
        "used_by": ["kishax-web ECS task (fallback)"]
      },
      "/kishax/web/mc-socket-port": {
        "description": "MC Socket通信ポート（フォールバック用）",
        "type": "String",
        "source": "Manual configuration", 
        "example": "9999",
        "used_by": ["kishax-web ECS task (fallback)"]
      }
    },
    "aws_credentials": {
      "/kishax/aws/region": {
        "description": "AWSリージョン設定",
        "type": "String",
        "source": "Manual configuration",
        "example": "ap-northeast-1",
        "used_by": ["mc-plugins", "kishax-web ECS task"]
      },
      "/kishax/aws/access-key-id": {
        "description": "AWS Access Key ID（mc-plugins用）",
        "type": "SecureString",
        "source": "Manual configuration - IAM User credentials",
        "used_by": ["mc-plugins"],
        "note": "本番環境ではIAMロールの使用を推奨"
      },
      "/kishax/aws/secret-access-key": {
        "description": "AWS Secret Access Key（mc-plugins用）",
        "type": "SecureString", 
        "source": "Manual configuration - IAM User credentials",
        "used_by": ["mc-plugins"],
        "note": "本番環境ではIAMロールの使用を推奨"
      }
    }
  },
  "setup_commands": {
    "description": "デプロイ後に実行するSSMパラメータ設定コマンド",
    "commands": [
      {
        "description": "CloudFormationスタック出力からSQS URLを取得・設定",
        "command": "aws ssm put-parameter --name '/kishax/sqs/web-to-mc-queue-url' --value \"$(aws cloudformation describe-stacks --stack-name kishax-infrastructure-v2 --query 'Stacks[0].Outputs[?OutputKey==`WebToMcQueueUrl`].OutputValue' --output text)\" --type String --overwrite"
      },
      {
        "description": "MC→Web SQS URL設定",
        "command": "aws ssm put-parameter --name '/kishax/sqs/mc-to-web-queue-url' --value \"$(aws cloudformation describe-stacks --stack-name kishax-infrastructure-v2 --query 'Stacks[0].Outputs[?OutputKey==`McToWebQueueUrl`].OutputValue' --output text)\" --type String --overwrite"
      },
      {
        "description": "API Gateway URL設定",
        "command": "aws ssm put-parameter --name '/kishax/api/gateway-url' --value \"$(aws cloudformation describe-stacks --stack-name kishax-infrastructure-v2 --query 'Stacks[0].Outputs[?OutputKey==`ApiGatewayUrl`].OutputValue' --output text)\" --type String --overwrite"
      },
      {
        "description": "AWSリージョン設定", 
        "command": "aws ssm put-parameter --name '/kishax/aws/region' --value 'ap-northeast-1' --type String --overwrite"
      }
    ]
  },
  "verification_commands": {
    "description": "SSMパラメータ設定確認用コマンド",
    "commands": [
      {
        "description": "全パラメータ一覧表示",
        "command": "aws ssm get-parameters-by-path --path '/kishax' --recursive --query 'Parameters[*].[Name,Value]' --output table"
      },
      {
        "description": "SQS関連パラメータ確認",
        "command": "aws ssm get-parameters --names '/kishax/sqs/web-to-mc-queue-url' '/kishax/sqs/mc-to-web-queue-url' --query 'Parameters[*].[Name,Value]' --output table"
      },
      {
        "description": "API Gateway URL確認",
        "command": "aws ssm get-parameter --name '/kishax/api/gateway-url' --query 'Parameter.Value' --output text"
      }
    ]
  },
  "environment_specific": {
    "development": {
      "stack_name": "kishax-infrastructure-dev",
      "parameter_prefix": "/kishax-dev"
    },
    "staging": {
      "stack_name": "kishax-infrastructure-staging", 
      "parameter_prefix": "/kishax-staging"
    },
    "production": {
      "stack_name": "kishax-infrastructure-prod",
      "parameter_prefix": "/kishax-prod"
    }
  },
  "ecs_task_environment_variables": {
    "kishax-web": {
      "from_ssm": [
        "MC_TO_WEB_QUEUE_URL=/kishax/sqs/mc-to-web-queue-url",
        "NEXT_PUBLIC_API_GATEWAY_URL=/kishax/api/gateway-url",
        "AWS_REGION=/kishax/aws/region"
      ],
      "direct": [
        "NODE_ENV=production",
        "PORT=3000",
        "AUTH_TRUST_HOST=true"
      ]
    },
    "mc-plugins": {
      "from_ssm": [
        "WEB_TO_MC_QUEUE_URL=/kishax/sqs/web-to-mc-queue-url", 
        "MC_TO_WEB_QUEUE_URL=/kishax/sqs/mc-to-web-queue-url",
        "API_GATEWAY_URL=/kishax/api/gateway-url",
        "AWS_REGION=/kishax/aws/region",
        "AWS_ACCESS_KEY_ID=/kishax/aws/access-key-id",
        "AWS_SECRET_ACCESS_KEY=/kishax/aws/secret-access-key"
      ],
      "config_files": [
        "velocity-kishax-config.yml",
        "spigot-kishax-config.yml"
      ]
    }
  },
  "security_notes": {
    "encryption": "SecureString タイプのパラメータはKMSで暗号化される",
    "access_control": "IAMポリシーでパラメータアクセスを制御",
    "rotation": "認証情報は定期的にローテーションすることを推奨", 
    "monitoring": "CloudTrailでパラメータアクセスをログ記録"
  }
}